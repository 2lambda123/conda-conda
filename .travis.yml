language: python
sudo: false

addons:
  apt:
    packages:
      - zsh

env:
  global: PYTHONUNBUFFERED=yes

matrix:
  include:
    - os: linux
      sudo: required
      python: '2.7'
      env: TOXENV=py27 PRE_INSTALL_CONDA=1
    - os: linux
      sudo: required
      python: '2.7'
      env: TOXENV=py27 PYCOSAT=0.6.1
    - os: linux
      sudo: required
      python: '2.7'
      env: TOXENV=py27
    - os: linux
      sudo: required
      python: '3.4'
      env: TOXENV=py34 PYCOSAT=0.6.1
    - os: linux
      sudo: required
      python: '3.4'
      env: TOXENV=py34
    - os: linux
      sudo: required
      python: '3.5'
      env: TOXENV=py35  PRE_INSTALL_CONDA=1
    - os: linux
      sudo: required
      python: '3.5'
      env: TOXENV=py35
    - os: osx
      language: generic
      env: TOXENV=py27 PYCOSAT=0.6.1
    - os: osx
      language: generic
      env: TOXENV=py27
    - os: osx
      language: generic
      env: TOXENV=py34 PYCOSAT=0.6.1
    - os: osx
      language: generic
      env: TOXENV=py34
    - os: osx
      language: generic
      env: TOXENV=py35

before_install:
  - '[ -z "$PRE_INSTALL_CONDA" ] || source utils/travis_bootstrap_conda.sh'
  - uname -a

install:
  - '[ -z "$PYCOSAT" ] || conda install pycosat="$PYCOSAT"'
  - '[ -z "$PRE_INSTALL_CONDA" ] || conda install pycrypto'
  - pip install -U tox

script:
  - if [ -z "$PRE_INSTALL_CONDA" ]; then
      export PYTEST_ADDOPTS="-m \'not installed\'"
    fi
  - printenv
  - tox -v

after_success:
  - pip install codecov
  - codecov --env TOX_ENV
